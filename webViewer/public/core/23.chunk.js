(function(){(window.wpCoreControlsBundle=window.wpCoreControlsBundle||[]).push([[23],{450:function(t,e,n){n.r(e);var i=n(1),a=n(10),o=n(2);t=n(49);var r=n(34),s=n(11);n=function(){function t(){this.init()}return t.prototype.init=function(){this.F6=!1,this.Se=this.hl=this.connection=null,this.Ur={},this.fa=this.mF=null},t.prototype.Ama=function(t){for(var e=this,n=0;n<t.length;++n){var i=t[n];switch(i.at){case"create":this.Ur[i.author]||(this.Ur[i.author]=i.aName),this.Cda(i);break;case"modify":this.fa.Nl(i.xfdf).then((function(t){e.fa.mb(t[0])}));break;case"delete":this.fa.Nl("<delete><id>"+i.aId+"</id></delete>")}}},t.prototype.Cda=function(t){var e=this;this.fa.Nl(t.xfdf).then((function(n){n=n[0],n.authorId=t.author,e.fa.mb(n),e.fa.trigger(a.b.UPDATE_ANNOTATION_PERMISSION,[n])}))},t.prototype.cda=function(t,e,n){this.hl&&this.hl(t,e,n)},t.prototype.preloadAnnotations=function(t){this.addEventListener("webViewerServerAnnotationsEnabled",this.cda.bind(this,t,"add",{imported:!1}),{once:!0})},t.prototype.initiateCollaboration=function(e,n,i){var s=this;if(e){s.Se=n,s.fa=i.sa(),i.addEventListener(a.e.DOCUMENT_UNLOADED,(function(){s.disableCollaboration()})),s.ana(e);var d=new XMLHttpRequest;d.addEventListener("load",(function(){if(200===d.status&&0<d.responseText.length)try{var n=JSON.parse(d.responseText);s.connection=exports.Ta.Gna(Object(r.j)(s.Se,"blackbox/"),"annot"),s.mF=n.id,s.Ur[n.id]=n.user_name,s.fa.nM(n.id),s.connection.Bqa((function(t){t.t&&t.t.startsWith("a_")&&t.data&&s.Ama(t.data)}),(function(){s.connection.send({t:"a_retrieve",dId:e}),s.trigger(t.Events.WEBVIEWER_SERVER_ANNOTATIONS_ENABLED,[s.Ur[n.id],s.mF])}),(function(){s.disableCollaboration()}))}catch(i){Object(o.g)(i.message)}})),d.open("GET",Object(r.j)(this.Se,"demo/SessionInfo.jsp")),d.withCredentials=!0,d.send(),s.F6=!0,s.fa.KY((function(t){return s.Ur[t.Author]||t.Author}))}else Object(o.g)("Document ID required for collaboration")},t.prototype.disableCollaboration=function(){this.hl&&(this.fa.removeEventListener(s.a.Events.ANNOTATION_CHANGED,this.hl),this.hl=null),this.connection&&this.connection.Kp(),this.fa&&this.fa.nM("Guest"),this.init(),this.trigger(t.Events.WEBVIEWER_SERVER_ANNOTATIONS_DISABLED)},t.prototype.ana=function(t){var e=this;this.hl&&this.fa.removeEventListener(s.a.Events.ANNOTATION_CHANGED,this.hl),this.hl=function(n,a,o){return Object(i.b)(this,void 0,void 0,(function(){var r,s,d,h,l,c,f,u,E;return Object(i.d)(this,(function(i){switch(i.label){case 0:return o.imported?[2]:(r={t:"a_"+a,dId:t,annots:[]},[4,e.fa.wI()]);case 1:for(s=i.ea(),"delete"!==a&&(d=(new DOMParser).parseFromString(s,"text/xml"),h=new XMLSerializer),l=0;l<n.length;l++)c=n[l],u=f=void 0,"add"===a?(f=d.querySelector('[name="'+c.Id+'"]'),u=h.serializeToString(f),E=null,c.InReplyTo&&(E=e.fa.Zf(c.InReplyTo).authorId||"default"),r.annots.push({at:"create",aId:c.Id,author:e.mF,aName:e.Ur[e.mF],parent:E,xfdf:"<add>"+u+"</add>"})):"modify"===a?(f=d.querySelector('[name="'+c.Id+'"]'),u=h.serializeToString(f),r.annots.push({at:"modify",aId:c.Id,xfdf:"<modify>"+u+"</modify>"})):"delete"===a&&r.annots.push({at:"delete",aId:c.Id});return 0<r.annots.length&&e.connection.send(r),[2]}}))}))}.bind(e),this.fa.addEventListener(s.a.Events.ANNOTATION_CHANGED,this.hl)},t.Events={WEBVIEWER_SERVER_ANNOTATIONS_ENABLED:"webViewerServerAnnotationsEnabled",WEBVIEWER_SERVER_ANNOTATIONS_DISABLED:"webViewerServerAnnotationsDisabled"},t}(),Object(t.a)(n),e["default"]=n}}])}).call(this||window);