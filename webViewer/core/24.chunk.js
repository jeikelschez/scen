(function(){(window.wpCoreControlsBundle=window.wpCoreControlsBundle||[]).push([[24],{402:function(t,e,n){n.r(e);var i=n(1),a=n(14),o=n(2);t=n(48);var r=n(32),s=n(9);n=function(){function t(){this.init()}return t.prototype.init=function(){this.N_=!1,this.me=this.Qj=this.connection=null,this.Jp={},this.xa=this.NB=null},t.prototype.Qda=function(t){for(var e=this,n=0;n<t.length;++n){var i=t[n];switch(i.at){case"create":this.Jp[i.author]||(this.Jp[i.author]=i.aName),this.P6(i);break;case"modify":this.xa.Kq(i.xfdf).then((function(t){e.xa.PR(t[0])}));break;case"delete":this.xa.Kq("<delete><id>"+i.aId+"</id></delete>")}}},t.prototype.P6=function(t){var e=this;this.xa.Kq(t.xfdf).then((function(n){n=n[0],n.authorId=t.author,e.xa.PR(n),e.xa.trigger(a.a.UPDATE_ANNOTATION_PERMISSION,[n])}))},t.prototype.r6=function(t,e,n){this.Qj&&this.Qj(t,e,n)},t.prototype.preloadAnnotations=function(t){this.addEventListener("webViewerServerAnnotationsEnabled",this.r6.bind(this,t,"add",{imported:!1}),{once:!0})},t.prototype.initiateCollaboration=function(e,n,i){var s=this;if(e){s.me=n,s.xa=i.Ga(),i.addEventListener(a.d.DOCUMENT_UNLOADED,(function(){s.disableCollaboration()})),s.mea(e);var d=new XMLHttpRequest;d.addEventListener("load",(function(){if(200===d.status&&0<d.responseText.length)try{var n=JSON.parse(d.responseText);s.connection=exports.Na.Wea(Object(r.h)(s.me,"blackbox/"),"annot"),s.NB=n.id,s.Jp[n.id]=n.user_name,s.xa.WS(n.id),s.connection.Qka((function(t){t.t&&t.t.startsWith("a_")&&t.data&&s.Qda(t.data)}),(function(){s.connection.send({t:"a_retrieve",dId:e}),s.trigger(t.Events.WEBVIEWER_SERVER_ANNOTATIONS_ENABLED,[s.Jp[n.id],s.NB])}),(function(){s.disableCollaboration()}))}catch(i){Object(o.g)(i.message)}})),d.open("GET",Object(r.h)(this.me,"demo/SessionInfo.jsp")),d.withCredentials=!0,d.send(),s.N_=!0,s.xa.Gba((function(t){return s.Jp[t.Author]||t.Author}))}else Object(o.g)("Document ID required for collaboration")},t.prototype.disableCollaboration=function(){this.Qj&&(this.xa.removeEventListener(s.a.Events.ANNOTATION_CHANGED,this.Qj),this.Qj=null),this.connection&&this.connection.In(),this.xa&&this.xa.WS("Guest"),this.init(),this.trigger(t.Events.WEBVIEWER_SERVER_ANNOTATIONS_DISABLED)},t.prototype.mea=function(t){var e=this;this.Qj&&this.xa.removeEventListener(s.a.Events.ANNOTATION_CHANGED,this.Qj),this.Qj=function(n,a,o){return Object(i.b)(this,void 0,void 0,(function(){var r,s,d,h,c,l,u,E,f;return Object(i.d)(this,(function(i){switch(i.label){case 0:return o.imported?[2]:(r={t:"a_"+a,dId:t,annots:[]},[4,e.xa.c3()]);case 1:for(s=i.ea(),"delete"!==a&&(d=(new DOMParser).parseFromString(s,"text/xml"),h=new XMLSerializer),c=0;c<n.length;c++)l=n[c],E=u=void 0,"add"===a?(u=d.querySelector('[name="'+l.Id+'"]'),E=h.serializeToString(u),f=null,l.InReplyTo&&(f=e.xa.HE(l.InReplyTo).authorId||"default"),r.annots.push({at:"create",aId:l.Id,author:e.NB,aName:e.Jp[e.NB],parent:f,xfdf:"<add>"+E+"</add>"})):"modify"===a?(u=d.querySelector('[name="'+l.Id+'"]'),E=h.serializeToString(u),r.annots.push({at:"modify",aId:l.Id,xfdf:"<modify>"+E+"</modify>"})):"delete"===a&&r.annots.push({at:"delete",aId:l.Id});return 0<r.annots.length&&e.connection.send(r),[2]}}))}))}.bind(e),this.xa.addEventListener(s.a.Events.ANNOTATION_CHANGED,this.Qj)},t.Events={WEBVIEWER_SERVER_ANNOTATIONS_ENABLED:"webViewerServerAnnotationsEnabled",WEBVIEWER_SERVER_ANNOTATIONS_DISABLED:"webViewerServerAnnotationsDisabled"},t}(),Object(t.a)(n),e["default"]=n}}])}).call(this||window);